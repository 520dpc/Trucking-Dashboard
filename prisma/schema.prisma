generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

///////////////////////////
// USER
///////////////////////////
model User {
  id               String                  @id @default(uuid()) // Primary key for the user.
  email            String                  @unique              // Unique email address for login/identification.
  passwordHash     String                                      // Hashed password for auth (placeholder until real auth flow).

  loads            Load[]                                     // All loads owned by this user.
  expenses         Expense[]                                  // All expenses owned by this user.
  customers        Customer[]                                // All customers (brokers/shippers) for this user.
  callNotes        CallNote[]                                // All call notes created by this user.
  dashboardLayouts DashboardWidgetLayout[]                   // All saved dashboard widget layouts for this user.

  createdAt        DateTime               @default(now())     // When the user row was created.
  updatedAt        DateTime               @updatedAt          // Auto-updated timestamp when the user row changes.
}




///////////////////////////
// CUSTOMER
///////////////////////////
model Customer {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])

  name      String
  type      String?
  mcNumber  String?
  email     String?
  phone     String?
  notes     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  loads     Load[]
  callNotes CallNote[]
}

///////////////////////////
// LOAD
///////////////////////////
model Load {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])

  customerId  String?
  customer    Customer? @relation(fields: [customerId], references: [id])

  broker      String?
  rate        Int
  miles       Int
  fuelCost    Int
  lumper      Int?
  tolls       Int?
  otherCosts  Int?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

///////////////////////////
// CALL NOTE (mini CRM)
///////////////////////////
model CallNote {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])

  customerId  String
  customer    Customer @relation(fields: [customerId], references: [id])

  content     String
  createdAt   DateTime @default(now())
}

///////////////////////////
// EXPENSE
///////////////////////////
model Expense {
  id             String   @id @default(uuid())

  userId         String
  user           User     @relation(fields: [userId], references: [id])

  categoryGroup  String?
  categoryKey    String?
  label          String?

  amount         Int
  description    String?
  incurredAt     DateTime @default(now())
  isRecurring    Boolean  @default(false)
  recurrenceFreq String?                       // "WEEKLY" | "BIWEEKLY" | "MONTHLY" | "ANNUAL"

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model DashboardWidgetLayout {                                      // Stores per-user layout info for each dashboard widget.
  id        String   @id @default(uuid())                          // Unique row ID for this layout entry.

  userId    String                                                  // FK â†’ User who owns this layout.
  user      User     @relation(fields: [userId], references: [id])  // Relation to the User model.

  widgetId  String                                                  // ID of the widget (e.g., "revenueKpi"); matches DashboardWidgetId in TS.

  x         Int                                                     // X coordinate in the grid (column index).
  y         Int                                                     // Y coordinate in the grid (row index).
  w         Int                                                     // Width of the widget in grid units (columns spanned).
  h         Int                                                     // Height of the widget in grid units (rows spanned).

  createdAt DateTime @default(now())                               // Timestamp when this layout entry was created.
  updatedAt DateTime @updatedAt                                    // Timestamp automatically updated on each change.

  @@unique([userId, widgetId])                                     // Ensures each user has at most one layout row per widget.
}




